{"version":3,"sources":["../src/screentime.js"],"names":["define","$","defaults","fields","percentOnScreen","reportInterval","googleAnalytics","callback","screentime","options","extend","parseInt","replace","counter","cache","log","looker","started","universalGA","classicGA","length","ga","_gaq","push","window","visibly","q","document","p","prefixes","props","m","visibleCallbacks","hiddenCallbacks","genericCallbacks","_callbacks","cachedPrefix","fn","onVisible","i","onHidden","getPrefix","b","visibilityState","_getProp","hidden","visibilitychange","t","call","arguments","isSupported","_execute","_visible","_hidden","_nativeSwitch","_listen","addEventListener","attachEvent","apply","init","Field","elem","selector","$elem","name","top","offset","height","bottom","width","Viewport","$window","scrollTop","sendGAEvent","field","time","onScreen","viewport","cond","buffered","partialView","is","checkViewport","each","key","val","report","data","isEmptyObject","startTimers","setInterval","reporter","stopTimers","clearInterval","reset","index"],"mappings":"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","sourcesContent":["/*!\r\n * @preserve\r\n * Screentime.js | v0.2.0\r\n * https://github.com/robflaherty/screentime\r\n * Copyright (c) 2016 Rob Flaherty (@robflaherty)\r\n * Licensed under the MIT and GPL licenses.\r\n */\r\n\r\n/* Universal module definition */\r\n\r\ndefine(['jquery'], function($) {\r\n\r\n  /* Screentime */\r\n\r\n  var defaults = {\r\n    fields: [],\r\n    percentOnScreen: '50%',\r\n    reportInterval: 10,\r\n    googleAnalytics: false,\r\n    callback: function(){}\r\n  };\r\n\r\n  $.screentime = function(options) {\r\n    options = $.extend({}, defaults, options);\r\n\r\n    // Convert perecent string to number\r\n    options.percentOnScreen = parseInt(options.percentOnScreen.replace('%', ''), 10);\r\n\r\n    var counter = {};\r\n    var cache = {};\r\n    var log = {};\r\n    var looker = null;\r\n    var started = false;\r\n    var universalGA, classicGA;\r\n\r\n    if (!options.fields.length) {\r\n      return;\r\n    }\r\n\r\n    if (options.googleAnalytics) {\r\n\r\n      if (typeof ga === \"function\") {\r\n        universalGA = true;\r\n      }\r\n\r\n      if (typeof _gaq !== \"undefined\" && typeof _gaq.push === \"function\") {\r\n        classicGA = true;\r\n      }\r\n\r\n    }\r\n\r\n    /*\r\n     * Utilities\r\n     */\r\n\r\n    /*!\r\n     * visibly - v0.6 Aug 2011 - Page Visibility API Polyfill\r\n     * http://github.com/addyosmani\r\n     * Copyright (c) 2011 Addy Osmani\r\n     * Dual licensed under the MIT and GPL licenses.\r\n     *\r\n     * Methods supported:\r\n     * visibly.onVisible(callback)\r\n     * visibly.onHidden(callback)\r\n     * visibly.hidden()\r\n     * visibly.visibilityState()\r\n     * visibly.visibilitychange(callback(state));\r\n     */\r\n\r\n    (function(){window.visibly={q:document,p:undefined,prefixes:[\"webkit\",\"ms\",\"o\",\"moz\",\"khtml\"],props:[\"VisibilityState\",\"visibilitychange\",\"Hidden\"],m:[\"focus\",\"blur\"],visibleCallbacks:[],hiddenCallbacks:[],genericCallbacks:[],_callbacks:[],cachedPrefix:\"\",fn:null,onVisible:function(i){if(typeof i==\"function\"){this.visibleCallbacks.push(i)}},onHidden:function(i){if(typeof i==\"function\"){this.hiddenCallbacks.push(i)}},getPrefix:function(){if(!this.cachedPrefix){for(var i=0;b=this.prefixes[i++];){if(b+this.props[2]in this.q){this.cachedPrefix=b;return this.cachedPrefix}}}},visibilityState:function(){return this._getProp(0)},hidden:function(){return this._getProp(2)},visibilitychange:function(i){if(typeof i==\"function\"){this.genericCallbacks.push(i)}var t=this.genericCallbacks.length;if(t){if(this.cachedPrefix){while(t--){this.genericCallbacks[t].call(this,this.visibilityState())}}else{while(t--){this.genericCallbacks[t].call(this,arguments[0])}}}},isSupported:function(i){return this.cachedPrefix+this.props[2]in this.q},_getProp:function(i){return this.q[this.cachedPrefix+this.props[i]]},_execute:function(i){if(i){this._callbacks=i==1?this.visibleCallbacks:this.hiddenCallbacks;var t=this._callbacks.length;while(t--){this._callbacks[t]()}}},_visible:function(){window.visibly._execute(1);window.visibly.visibilitychange.call(window.visibly,\"visible\")},_hidden:function(){window.visibly._execute(2);window.visibly.visibilitychange.call(window.visibly,\"hidden\")},_nativeSwitch:function(){this[this._getProp(2)?\"_hidden\":\"_visible\"]()},_listen:function(){try{if(!this.isSupported()){if(this.q.addEventListener){window.addEventListener(this.m[0],this._visible,1);window.addEventListener(this.m[1],this._hidden,1)}else{if(this.q.attachEvent){this.q.attachEvent(\"onfocusin\",this._visible);this.q.attachEvent(\"onfocusout\",this._hidden)}}}else{this.q.addEventListener(this.cachedPrefix+this.props[1],function(){window.visibly._nativeSwitch.apply(window.visibly,arguments)},1)}}catch(i){}},init:function(){this.getPrefix();this._listen()}};this.visibly.init()})();\r\n\r\n    function random() {\r\n      return Math.round(Math.random() * 2147483647);\r\n    }\r\n\r\n    /*\r\n     * Constructors\r\n     */\r\n\r\n    function Field(elem) {\r\n      this.selector = elem.selector;\r\n      $elem = this.$elem = $(elem.selector);\r\n      this.name = elem.name;\r\n\r\n      this.top = $elem.offset().top;\r\n      this.height = $elem.height();\r\n      this.bottom = this.top + this.height;\r\n      this.width = $elem.width();\r\n    }\r\n\r\n    function Viewport() {\r\n      var $window = $(window);\r\n\r\n      this.top = $window.scrollTop();\r\n      this.height = $window.height();\r\n      this.bottom = this.top + this.height;\r\n      this.width = $window.width();\r\n    }\r\n\r\n    /*\r\n     * Do Stuff\r\n     */\r\n\r\n    function sendGAEvent(field, time) {\r\n\r\n      if (universalGA) {\r\n        ga('send', 'event', 'Screentime', 'Time on Screen', field, parseInt(time, 10), {'nonInteraction': true});\r\n      }\r\n\r\n      if (classicGA) {\r\n        _gaq.push(['_trackEvent', 'Screentime', 'Time on Screen', field, parseInt(time, 10), true]);\r\n      }\r\n\r\n    }\r\n\r\n    function onScreen(viewport, field) {\r\n      var cond, buffered, partialView;\r\n\r\n      // Field not hidden by design\r\n      if($(field.selector).is(':hidden') ){\r\n        return false;\r\n      }\r\n      \r\n      // Field entirely within viewport\r\n      if ((field.bottom <= viewport.bottom) && (field.top >= viewport.top)) {\r\n        return true;\r\n      }\r\n\r\n       // Field bigger than viewport\r\n      if (field.height > viewport.height) {\r\n\r\n        cond = (viewport.bottom - field.top) > (viewport.height / 2) && (field.bottom - viewport.top) > (viewport.height / 2);\r\n\r\n        if (cond) {\r\n          return true;\r\n        }\r\n\r\n      }\r\n\r\n      // Partially in view\r\n      buffered = (field.height * (options.percentOnScreen/100));\r\n      partialView = ((viewport.bottom - buffered) >= field.top && (field.bottom - buffered) > viewport.top);\r\n\r\n      return partialView;\r\n\r\n    }\r\n\r\n    function checkViewport() {\r\n      var viewport = new Viewport();\r\n\r\n      $.each(cache, function(key, val) {\r\n        if (onScreen(viewport, val)) {\r\n          log[key] += 1;\r\n          counter[key] += 1;\r\n        }\r\n      });\r\n\r\n    }\r\n\r\n    function report() {\r\n\r\n      var data = {};\r\n\r\n      $.each(counter, function(key, val) {\r\n        if (val > 0) {\r\n          data[key] = val;\r\n          counter[key] = 0;\r\n\r\n          if (options.googleAnalytics) {\r\n            sendGAEvent(key, val);\r\n          }\r\n\r\n        }\r\n      });\r\n\r\n      if (!$.isEmptyObject(data)) {\r\n        options.callback.call(this, data, log);\r\n      }\r\n\r\n    }\r\n\r\n    function startTimers() {\r\n\r\n      if (!started) {\r\n        checkViewport();\r\n        started = true;\r\n      }\r\n\r\n      looker = setInterval(function() {\r\n        checkViewport();\r\n      }, 1000);\r\n\r\n      reporter = setInterval(function() {\r\n        report();\r\n      }, options.reportInterval * 1000);\r\n\r\n    }\r\n\r\n    function stopTimers() {\r\n      clearInterval(looker);\r\n      clearInterval(reporter);\r\n    }\r\n\r\n    $.screentime.reset = function() {\r\n      stopTimers();\r\n\r\n      $.each(cache, function(key, val) {\r\n        log[key] = 0;\r\n        counter[key] = 0;\r\n      });\r\n\r\n      startTimers();\r\n    }\r\n\r\n    function init() {\r\n\r\n      $.each(options.fields, function(index, elem) {\r\n        if ($(elem.selector).length) {\r\n          var field = new Field(elem);\r\n          cache[field.name] = field;\r\n          counter[field.name] = 0;\r\n          log[field.name] = 0;\r\n        }\r\n      });\r\n\r\n      startTimers();\r\n\r\n      visibly.onHidden(function() {\r\n        stopTimers();\r\n      });\r\n\r\n      visibly.onVisible(function() {\r\n        stopTimers();\r\n        startTimers();\r\n      });\r\n\r\n    }\r\n\r\n    init();\r\n\r\n  };\r\n});\r\n"],"file":"screentime.min.js"}